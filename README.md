# Konkur AI Study Planner (برنامه ریز هوشمند کنکور)

## 1. Project Overview

This is a responsive Flutter application designed to help students prepare for the Iranian National University Entrance Exam (Konkur). The app leverages the power of the Gemini AI to create dynamic, personalized, and optimized study plans based on the official subject weighting (`بودجه بندی`), the user's self-assessed strengths, and the time remaining until the exam.

All data is stored locally on the device using an SQLite database, ensuring privacy and offline access. The app also features push notifications to remind users of their scheduled tasks and an interactive timer to track study sessions.

## 2. Core Features

- **AI-Powered Planning:** Utilizes the Gemini API to generate a daily study schedule.
- **Official Syllabus Integration:** Contains the `بودجه بندی` (topic weighting) for the Math & Physics track to prioritize important subjects.
- **Personalized Strengths:** Allows users to select topics they are more skilled in, which the AI uses as a key input.
- **Dynamic Daily Schedule:** Displays the generated plan in a clear, easy-to-follow daily format.
- **Interactive Task Tracking with Feedback:** Each study task includes a timer. At the end of a session, the user provides feedback, which the AI uses to refine future plans.
- **Task Reminders:** Sends push notifications for the start and end times of study blocks.
- **Local First:** All user data is stored and managed on the device's local database.
- **Responsive UI:** The user interface is designed to work seamlessly on various screen sizes.

## 3. Application Pages (Screens)

The application will be structured around four main pages:

1. **هوش مصنوعی (AI Agent)::**
    - This is the main interaction screen.
    - Users can chat with the Gemini-powered agent to generate a new plan, update their progress, or ask for adjustments.
    - Example prompt: "با توجه به درس‌هایی که انتخاب کردم و با فرض اینکه ۱۱ روز وقت دارم، یک برنامه روزانه برایم بساز."
    - The agent's response will be a structured plan that gets saved to the local database.

2. **بودجه بندی (Syllabus Breakdown):**
    - A read-only screen displaying the official Konkur syllabus and the number of questions per topic.
    - This helps users make informed decisions when selecting their strong subjects.
    - Data will be pre-populated in the local database.

3. **درس های من (My Subjects):**
    - An interactive checklist where users select the topics they feel most confident about.
    - This selection is saved locally and is a critical input for the AI planning agent.

4. **برنامه من (My Plan):**
    - Displays the study plan generated by the AI in a daily list or timeline format.
    - Each task item has a **"Play" button** that starts a countdown timer for the allocated duration.
    - When the timer finishes, a dialog prompts the user to enter a brief description of their session (e.g., "مبحث مشتق را خوب فهمیدم اما در تست‌های بهینه‌سازی مشکل دارم").
    - This feedback is saved and used by the AI for future planning.
    - Users can manually mark tasks as completed.

## 4. Project Structure

The project follows a standard Flutter application structure, with key directories organized as follows:

- **`lib/`**: Contains the main Dart source code for the application.
    - **`main.dart`**: The entry point of the Flutter application.
    - **`constants/`**: Defines application-wide constants.
    - **`database/`**: Handles local SQLite database operations.
    - **`models/`**: Contains data models for the application (e.g., `study_task`, `topic`).
    - **`providers/`**: Manages application state using the `provider` package.
    - **`screens/`**: Implements the different UI screens of the application.
    - **`services/`**: Contains services for API calls (Gemini) and notifications.
    - **`utils/`**: Utility functions and helpers.
- **`android/`**: Android-specific project files.
- **`ios/`**: iOS-specific project files.
- **`linux/`**: Linux-specific desktop project files.
- **`macos/`**: macOS-specific desktop project files.
- **`web/`**: Web-specific project files.
- **`windows/`**: Windows-specific desktop project files.
- **`build/`**: Generated build artifacts.
- **`.metadata`**: Flutter project metadata.
- **`analysis_options.yaml`**: Dart linter and static analysis rules.
- **`pubspec.yaml`**: Project dependencies and metadata for Dart/Flutter.
- **`pubspec.lock`**: Records the specific versions of dependencies used.
- **`README.md`**: Project overview and documentation.

## 5. Step 1: Flutter Project Setup Guide

Here is the step-by-step guide to get your development environment ready.

1. **Install Flutter SDK:**
    - Follow the official guide: [Flutter Official Installation Guide](https://docs.flutter.dev/get-started/install).

2. **Verify Installation:**
    - Run `flutter doctor` in your terminal and address any issues.

3. **Create the Flutter Project:**
    - Run `flutter create konkur_planner` in your terminal.

4. **Open the Project:**
    - Open the `konkur_planner` folder in your code editor (e.g., VS Code).

5. **Add Dependencies (Packages):**
    - Open `pubspec.yaml` and add the following:

    ```yaml
    dependencies:
      flutter:
        sdk: flutter
      
      # For State Management
      provider: ^6.1.2
    
      # For Local Database (SQLite)
      sqflite: ^2.3.3+1
      path_provider: ^2.1.3
    
      # For Push Notifications
      flutter_local_notifications: ^17.1.2
    
      # For making API calls to Gemini
      http: ^1.2.1
    
      # For date and time formatting
      intl: ^0.19.0
      sqflite_common_ffi: ^2.3.3
      sqflite_common_ffi_web: ^1.0.0
    
      path: any
      timezone: any
    ```

6. **Install the Packages:**
    - Run `flutter pub get` in your terminal.

7. **Run the App:**
    - Connect a device or start an emulator and run `flutter run`.

## 5. Required Packages & Their Purpose

- **`provider`**: For state management.
- **`sqflite` & `path_provider`**: For the local SQLite database.
- **`flutter_local_notifications`**: For scheduling push notifications.
- **`http`**: For making API calls to the Gemini AI.
- **`intl`**: For formatting dates and times.

## 6. Local Database (SQLite) Schema

We will structure our local database with the following tables:

**`topics`**

| Column           | Type         | Description                        |
|:-----------------|:-------------|:-----------------------------------|
| `id`             | INTEGER (PK) | Unique ID for the topic            |
| `name`           | TEXT         | Name of the topic (e.g., "مثلثات") |
| `subject`        | TEXT         | Parent subject (e.g., "حسابان")    |
| `question_count` | INTEGER      | Number of questions in Konkur      |

**`user_selections`**

| Column      | Type         | Description                                          |
|:------------|:-------------|:-----------------------------------------------------|
| `topic_id`  | INTEGER (FK) | Foreign key referencing `topics.id`                  |
| `is_strong` | INTEGER      | 1 if the user selected it as a strength, 0 otherwise |

**`study_tasks`**

| Column          | Type            | Description                                             |
|:----------------|:----------------|:--------------------------------------------------------|
| `id`            | INTEGER (PK)    | Unique ID for the task                                  |
| `topic_id`      | INTEGER (FK)    | The topic this task is for                              |
| `task_date`     | TEXT            | The date of the task (e.g., "2024-07-15")               |
| `start_time`    | TEXT            | The start time (e.g., "09:00")                          |
| `end_t****ime`  | TEXT            | The end time (e.g., "11:30")                            |
| `task_type`     | TEXT            | "مرور" (Review) or "تست" (Test-taking)                  |
| `status`        | TEXT            | "pending", "in_progress", "completed"                   |
| `user_feedback` | TEXT (NULLABLE) | User's description of the session after the timer ends. |

## 7. AI Agent & Tools Logic

The AI Agent's intelligence is enhanced by user feedback, creating an adaptive planning loop.

1. **Input Gathering:** The app collects four key pieces of information for the AI:
    - The list of all topics and their question counts.
    - The list of topics the user has marked as strong.
    - **Crucially, the history of `user_feedback` from previous tasks.**
    - The user's new request (e.g., "regenerate my plan for the next 5 days").

2. **Prompt Engineering:** The app sends a carefully crafted prompt to the Gemini API. The prompt will now include the user's past feedback.
    - Example: "...The user previously reported 'difficulty with optimization tests' for the 'Calculus' topic. Please allocate more review time for this sub-topic and schedule a dedicated test-taking session for it..."

3. **AI as a "Tool" User:** The AI's primary "tool" is its ability to generate a structured JSON representing the daily schedule. The app provides the schema for the JSON it expects. The AI doesn't directly control the database; it provides the *data* for the app to use.

4. **Data Processing:** The Flutter app receives the JSON response from Gemini, parses it, and populates or updates the `study_tasks` table in the local SQLite database.

5. **UI Update & Notifications:** Once the database is updated, the `برنامه من` screen reflects the new, smarter plan, and the notification service schedules reminders for all new "pending" tasks.
